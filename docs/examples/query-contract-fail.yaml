# Query Contract Check Examples (Fail)
# ======================================
# Demonstrates query contract checks that intentionally FAIL.
# These examples show common failure scenarios:
# - Wrong column names
# - Wrong column order
# - Wrong data types
# - Wrong nullability
# - Wrong row count
#
# Exit code: 1 (validation failures)
# Adapt the connection string and queries to match your database schema.

version: 1

connections:
  - name: my-database
    connectionStringEnv: SQLGUARD_CONNECTION_STRING

suites:
  - name: query-contract-failures
    connection: my-database
    checks:
      # Failure 1: Wrong column names
      - type: queryContract
        name: wrong-column-names
        description: Expects columns that don't exist (will fail)
        query: |
          SELECT 
            CustomerId,
            CustomerCode,
            CustomerName
          FROM dbo.Customers
          WHERE CustomerId = 1
        expectedColumns:
          - name: CustomerId
            sqlType: int
            nullable: false
          - name: CustomerCode
            sqlType: nvarchar
            nullable: false
          - name: FullName  # ❌ Wrong: actual column is CustomerName
            sqlType: nvarchar
            nullable: false
      
      # Failure 2: Wrong column order
      - type: queryContract
        name: wrong-column-order
        description: Expects columns in different order (will fail)
        query: |
          SELECT 
            CustomerName,  # Query returns this first
            CustomerId     # Query returns this second
          FROM dbo.Customers
          WHERE CustomerId = 1
        expectedColumns:
          - name: CustomerId      # ❌ Wrong: expecting this first but comes second
            sqlType: int
            nullable: false
          - name: CustomerName    # ❌ Wrong: expecting this second but comes first
            sqlType: nvarchar
            nullable: false
      
      # Failure 3: Wrong data type
      - type: queryContract
        name: wrong-data-type
        description: Expects wrong SQL type for column (will fail)
        query: |
          SELECT 
            CustomerId,
            TotalAmount
          FROM dbo.Orders
          WHERE OrderId = 1
        expectedColumns:
          - name: CustomerId
            sqlType: int
            nullable: false
          - name: TotalAmount
            sqlType: int  # ❌ Wrong: actual type is decimal(18,2)
            nullable: false
      
      # Failure 4: Wrong nullability
      - type: queryContract
        name: wrong-nullability
        description: Expects wrong nullability for column (will fail)
        query: |
          SELECT 
            CustomerCode,
            Email
          FROM dbo.Customers
          WHERE CustomerId = 1
        expectedColumns:
          - name: CustomerCode
            sqlType: nvarchar
            nullable: true  # ❌ Wrong: CustomerCode is NOT NULL
          - name: Email
            sqlType: nvarchar
            nullable: false  # ❌ Wrong: Email IS NULL
      
      # Failure 5: Wrong row count
      - type: queryContract
        name: wrong-row-count
        description: Expects wrong number of rows (will fail)
        query: |
          SELECT 
            CustomerId,
            CustomerCode
          FROM dbo.Customers
          WHERE IsActive = 1
          ORDER BY CustomerId
        expectedColumns:
          - name: CustomerId
            sqlType: int
            nullable: false
          - name: CustomerCode
            sqlType: nvarchar
            nullable: false
        expectedRowCount: 10  # ❌ Wrong: example database has 4 active customers, not 10
      
      # Failure 6: Missing columns in expectation
      - type: queryContract
        name: missing-expected-columns
        description: Query returns more columns than expected (will fail)
        query: |
          SELECT 
            CustomerId,
            CustomerCode,
            CustomerName,
            Email
          FROM dbo.Customers
          WHERE CustomerId = 1
        expectedColumns:
          - name: CustomerId
            sqlType: int
            nullable: false
          - name: CustomerCode
            sqlType: nvarchar
            nullable: false
          # ❌ Wrong: Missing CustomerName and Email in expectations
          #           Query returns 4 columns but only 2 are expected

